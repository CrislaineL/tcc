<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Pet Gato</title>
    <link rel="stylesheet" href="./css/produtos.css">
</head>
<body>

<header>
    <h1>ğ“Ÿğ“®ğ“½ ğ“–ğ“ªğ“½ğ“¸</h1>
    <button onclick="window.location.href='admin.html'">
        Voltar para a tela inicial admin
    </button>
</header>

<div class="Containerheader">
    <button onclick="window.location.href='consultaadmin.html'">
        Consulta
    </button>
    <button id="novoProdutoBtn">
        Novo Produto
    </button>
</div>

<div id="produtosLista" class="produtos-container"></div>

<div id="modal-editar" class="modal">
  <div class="modal-content">
    <span class="close" onclick="fecharModalEditar()">&times;</span>
    <h2>Editar Produto</h2>
    <form id="form-editar">
      <label for="editar-nome">Nome:</label>
      <input type="text" id="editar-nome" required>

      <label for="editar-descricao">DescriÃ§Ã£o:</label>
      <textarea id="editar-descricao" required></textarea>

      <label for="editar-preco">PreÃ§o:</label>
      <input type="number" id="editar-preco" step="0.01" required>

      <label for="editar-imagem">Imagem (URL):</label>
      <input type="url" id="editar-imagem" required>

      <input type="hidden" id="editar-id">

      <button type="submit">Salvar</button>
    </form>
  </div>
</div>

<div id="novoProdutoModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Cadastrar Novo Produto</h2>
    <form id="produtoForm">
      <label for="nome">Nome do Produto:</label>
      <input type="text" id="nome" name="nome" required><br><br>
      
      <label for="descricao">DescriÃ§Ã£o:</label>
      <textarea id="descricao" name="descricao" required></textarea><br><br>

      <label for="preco">PreÃ§o:</label>
      <input type="number" id="preco" name="preco" required><br><br>
      
      <label for="imagem">URL da Imagem:</label>
      <input type="url" id="imagem" name="imagem" placeholder="https://exemplo.com/imagem.jpg" required><br><br>
      
      <label for="categoria">Categoria:</label>
      <select id="categoria" name="categoria" required>
        <option value="cachorro">Cachorro</option>
        <option value="gato">Gato</option>
        <option value="peixe">Peixe</option>
        <option value="passaro">PÃ¡ssaro</option>
      </select><br><br>

      <button type="submit">Cadastrar Produto</button>
    </form>
  </div>
</div>

<script>
  const urlVercel = 'https://backend-tcc-petshop-petgato-2025.vercel.app/produto';
  let produtos = [];

  function buscarProdutos() {
    fetch(urlVercel)
      .then(response => response.json())
      .then(data => {
        produtos = data;
        exibirProdutos();
      })
      .catch(error => {
        console.error('Erro ao carregar os produtos:', error);
        document.getElementById('produtosLista').innerHTML = '<p>Erro ao carregar produtos.</p>';
      });
  }

  function exibirProdutos() {
    const container = document.getElementById('produtosLista');
    container.innerHTML = '';

    produtos.forEach(produto => {
      const card = document.createElement('div');
      card.className = 'produto-card';

      card.innerHTML = `
        <img src="${produto.imagem}" alt="${produto.nome}">
        <div class="info">
          <h3>${produto.nome}</h3>
          <p>${produto.descricao}</p>
          <p class="preco">R$ ${produto.preco.toFixed(2)}</p>
          <div class="acoes">
            <button onclick="excluirProduto(${produto.id})">Excluir</button>
          </div>
        </div>
      `;

      container.appendChild(card);
    });
  }

  function excluirProduto(id) {
    if (!confirm("Tem certeza que deseja excluir este produto?")) return;

    Promise.all([
      fetch(`${urlVercel}/${id}`, { method: "DELETE" })
    ])
      .then(([res1]) => {
        if (!res1.ok) throw new Error("Erro ao excluir");
        alert("Produto excluÃ­do com sucesso!");
        buscarProdutos();
      })
      .catch(error => {
        console.error(error);
        alert("Erro ao excluir produto.");
      });
  }

  document.getElementById("novoProdutoBtn").onclick = function () {
    document.getElementById("novoProdutoModal").style.display = "block";
  };

  function closeModal() {
    document.getElementById("novoProdutoModal").style.display = "none";
  }

  document.getElementById("produtoForm").onsubmit = function (event) {
    event.preventDefault();

    const nome = document.getElementById("nome").value;
    const descricao = document.getElementById("descricao").value;
    const preco = parseFloat(document.getElementById("preco").value);
    const imagem = document.getElementById("imagem").value;
    const categoria = document.getElementById("categoria").value;

    const produtoData = {
      nome,
      descricao,
      preco,
      imagem,
      categoria
    };

    Promise.all([
      fetch(urlVercel, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(produtoData),
      })
    ])
      .then(responses => Promise.all(responses.map(r => r.json())))
      .then(() => {
        alert("Produto cadastrado com sucesso!");
        closeModal();
        buscarProdutos();
      })
      .catch(error => {
        console.error("Erro ao cadastrar:", error);
        alert("Erro ao cadastrar produto.");
      });
  };
  window.onload = buscarProdutos;
</script>
</body>
</html>
